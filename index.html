<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>WC / 楓幣 計算器</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap');

body {
    font-family: 'Comic Neue', 'Comic Sans MS', sans-serif;
    background: linear-gradient(to bottom, #ffe4e1, #fff0f5);
    padding: 30px;
    color: #4d2e2e;
}

h2 {
    text-align: center;
    font-size: 32px;
    color: #d94f4f;
    margin-bottom: 20px;
}

.row {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    background-color: #fff0f5;
    border: 2px solid #ffb6c1;
    border-radius: 12px;
    padding: 10px;
    margin-bottom: 10px;
    box-shadow: 2px 2px 8px rgba(255,182,193,.5);
    font-size: 14px;
    font-weight: bold;
}

select, input {
    padding: 6px;
    font-size: 14px;
    border-radius: 8px;
    border: 1px solid #ff69b4;
    text-align: center;
    font-family: 'Comic Neue', sans-serif;
}

input { width: 100px; }
.qty { width: 60px; }
.wc-select { width: 260px; }

.formula {
    font-size: 13px;
    color: #c71585;
    min-width: 150px;
}

.result {
    font-weight: bold;
    color: #ff4500;
    min-width: 180px;
}

.best {
    margin-top: 4px;
    font-size: 13px;
    color: #d4a017;
    font-weight: bold;
}

button {
    padding: 6px 12px;
    font-size: 14px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    background-color: #ff69b4;
    color: white;
    font-weight: bold;
}

button:hover { background-color: #ff1493; }

.remove-btn {
    background-color: #ff6f61;
}
.remove-btn:hover {
    background-color: #ff4c3b;
}

#add-btn {
    display: block;
    margin: 15px auto;
    background-color: #ffa07a;
}
#add-btn:hover {
    background-color: #ff7f50;
}
</style>
</head>

<body>

<h2> WC / 楓幣 計算器 </h2>

<div class="row">
    <label>方案：</label>
    <select id="package" onchange="calculateAll()">
        <option value="120|800">120 台幣 = 800 WC</option>
        <option value="1990|13200" selected>1990 台幣 = 13,200 WC</option>
    </select>
</div>

<div id="calculator"></div>

<button id="add-btn" onclick="addRow()">➕ 新增方案</button>

<script>
const defaultItems = [
    { name: "突襲卷", wc: "1200|7" },
    { name: "高級瞬移石", wc: "4000|110" },
    { name: "飄雪結晶", wc: "3000|110" },
    { name: "神秘背包", wc: "3750|15" },
    { name: "護身符咒", wc: "4500|110" },
    { name: "AP初始化卷軸", wc: "800|2" },
    { name: "SP初始化卷軸", wc: "600|2" },
    { name: "高效能喇叭(紅色)", wc: "1200|11" },
    { name: "高效能喇叭(黃色)", wc: "1400|11" }
];

function formatNumber(n) {
    return n.toLocaleString("zh-TW");
}

function parseNumber(s) {
    return parseFloat(String(s).replace(/,/g, "")) || 0;
}

function formatInput(el) {
    const v = parseNumber(el.value);
    el.value = v ? formatNumber(v) : "";
}

function calculateRow(el) {
    const row = el.closest(".calc-row");
    const wcTotal = parseNumber(row.querySelector(".wc").value);
    const maple = parseNumber(row.querySelector(".maple").value);
    const qty = parseNumber(row.querySelector(".qty").value);
    const result = row.querySelector(".result span");
    const formula = row.querySelector(".formula");

    formula.innerText = "";
    result.innerText = "";

    if (!wcTotal || !maple || qty <= 0) {
        updateBestChoice();
        return;
    }

    const wcUnit = Math.floor(wcTotal / qty);
    formula.innerText = `單價: ${formatNumber(wcUnit)} WC`;

    const [twd, totalWC] =
        document.getElementById("package").value.split("|").map(Number);

    const wcPerTwd = totalWC / twd;
    const maplePerTwd = Math.floor((maple / wcUnit) * wcPerTwd);

    result.innerText = formatNumber(maplePerTwd);
    updateBestChoice();
}

function updateBestChoice() {
    let bestRow = null;
    let bestValue = 0;

    document.querySelectorAll(".calc-row").forEach(row => {
        row.querySelector(".best")?.remove();
        const v = parseNumber(row.querySelector(".result span").innerText);
        if (v > bestValue) {
            bestValue = v;
            bestRow = row;
        }
    });

    if (bestRow && bestValue > 0) {
        const best = document.createElement("div");
        best.className = "best";
        best.innerText = "⭐ 最佳選擇（每 1 台幣楓幣最高）";
        bestRow.appendChild(best);
    }
}

function calculateAll() {
    document.querySelectorAll(".calc-row input").forEach(i => calculateRow(i));
}

function wcPackageChanged(sel) {
    const row = sel.closest(".calc-row");
    if (!sel.value) return;

    const [total, qty] = sel.value.split("|").map(Number);
    row.querySelector(".qty").value = qty;
    row.querySelector(".wc").value = formatNumber(total);
    calculateRow(row.querySelector(".wc"));
}

function addRow(defaultIndex = null) {
    const row = document.createElement("div");
    row.className = "row calc-row";

    row.innerHTML = `
        <select class="wc-select" onchange="wcPackageChanged(this)">
            <option value="">WC方案</option>
            ${defaultItems.map(it =>
                `<option value="${it.wc}">
                    ${it.name}（${it.wc.replace("|"," WC / ")}）
                 </option>`
            ).join("")}
        </select>

        <input class="qty" type="text" inputmode="numeric"
               placeholder="數量" oninput="calculateRow(this)">

        <input class="wc" type="text" inputmode="numeric"
               placeholder="WC總價"
               oninput="calculateRow(this)" onblur="formatInput(this)">

        <input class="maple" type="text" inputmode="numeric"
               placeholder="楓幣"
               oninput="calculateRow(this)" onblur="formatInput(this)">

        <div class="formula"></div>
        <div class="result">1 台幣 = <span></span> 楓幣</div>
        <button class="remove-btn"
            onclick="this.closest('.calc-row').remove(); updateBestChoice()">❌</button>
    `;

    document.getElementById("calculator").appendChild(row);

    if (defaultIndex !== null) {
        const sel = row.querySelector(".wc-select");
        sel.selectedIndex = defaultIndex + 1;
        wcPackageChanged(sel);
    }
}

// 預設三行
addRow(0); // 突襲卷
addRow(1); // 高級瞬移石
addRow(2); // 飄雪結晶
</script>

</body>
</html>
